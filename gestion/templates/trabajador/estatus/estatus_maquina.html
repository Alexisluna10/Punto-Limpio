{% extends 'base_trabajador.html' %}

{% block title_page %}
Estatus de M치quinas
{% endblock %}

{% block trabajador_content %}

<div class="main-content">

    <div class="trab-estatus-header">
        <div>
            <h2 class="trab-estatus-titulo">Control de M치quinas</h2>
        </div>
        <button class="trab-estatus-btn-agregar" onclick="abrirModalAgregar()">
            <span>+</span> AGREGAR M츼QUINA
        </button>
    </div>

    <h3 class="trab-section-title">Lavadoras</h3>
    <div class="trab-estatus-grid">
        {% for maquina in lavadoras %}
        {% include 'trabajador/estatus/tarjeta_maquina.html' %}
        {% empty %}
        <p class="text-muted">No hay lavadoras registradas.</p>
        {% endfor %}
    </div>

    <h3 class="trab-section-title" style="margin-top: 50px;">Secadoras</h3>
    <div class="trab-estatus-grid">
        {% for maquina in secadoras %}
        {% include 'trabajador/estatus/tarjeta_maquina.html' %}
        {% empty %}
        <p class="text-muted">No hay secadoras registradas.</p>
        {% endfor %}
    </div>

</div>

<div id="modalAgregarM" class="modal-overlay" style="display: none;">
    <div class="modern-card" style="max-width: 500px; padding: 30px;">
        <h3 style="color: #008CC9; text-align: center;">Registrar Nueva M치quina</h3>

        <form method="POST" class="trab-incidencia-form" style="margin-top: 20px;">
            {% csrf_token %}
            <input type="hidden" name="accion" value="agregar">

            <div class="form-group" style="margin-bottom: 15px;">
                <label class="trab-incidencia-label">Nombre / Identificador</label>
                <input type="text" name="nombre" class="input-modern trab-incidencia-input"
                    placeholder="Ej: Lavadora 06" required>
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label class="trab-incidencia-label">Tipo</label>
                <select name="tipo" class="input-modern trab-incidencia-select">
                    <option value="lavadora">Lavadora</option>
                    <option value="secadora">Secadora</option>
                </select>
            </div>

            <div class="buttons-container" style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" class="btn-cancel" onclick="cerrarModalAgregar()"
                    style="padding: 10px; cursor: pointer;">Cancelar</button>
                <button type="submit" class="btn-submit"
                    style="background: #008CC9; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">REGISTRAR</button>
            </div>
        </form>
    </div>
</div>

<div id="modalOpciones" class="modal-overlay" style="display: none;">
    <div class="modern-card" style="max-width: 400px; padding: 30px; text-align: center;">
        <h3 id="tituloMaquinaOpc" style="margin-bottom: 20px;">Opciones</h3>

        <form method="POST" id="formOpciones">
            {% csrf_token %}
            <input type="hidden" name="maquina_id" id="input_maquina_id_opc">
            <input type="hidden" name="accion" id="input_accion_opc">

            <button type="button" class="btn-base"
                style="width: 100%; margin-bottom: 10px; background: #FF9800; color: white; padding: 10px; border:none; border-radius:5px; cursor:pointer;"
                onclick="enviarOpcion('reportar_mantenimiento')">
                游댢 Reportar Falla / Mantenimiento
            </button>

            <button type="button" class="btn-base"
                style="width: 100%; background: #D32F2F; color: white; padding: 10px; border:none; border-radius:5px; cursor:pointer;"
                onclick="enviarOpcion('baja_definitiva')">
                Dar de Baja Definitiva
            </button>
        </form>

        <button class="btn-small"
            style="margin-top: 20px; background: none; border: none; cursor: pointer; color: #888;"
            onclick="cerrarModalOpciones()">Cancelar</button>
    </div>
</div>

<script>
    // --- MODAL AGREGAR ---
    function abrirModalAgregar() {
        const modal = document.getElementById('modalAgregarM');
        modal.style.display = 'flex';
    }
    function cerrarModalAgregar() {
        document.getElementById('modalAgregarM').style.display = 'none';
    }

    // --- MODAL OPCIONES (DIN츼MICO) ---
    function abrirOpciones(id, nombre) {
        document.getElementById('tituloMaquinaOpc').innerText = 'Gestionar: ' + nombre;
        document.getElementById('input_maquina_id_opc').value = id;
        document.getElementById('modalOpciones').style.display = 'flex';
    }

    function cerrarModalOpciones() {
        document.getElementById('modalOpciones').style.display = 'none';
    }

    function enviarOpcion(accion) {
        let confirmacion = false;
        if (accion === 'baja_definitiva') confirmacion = confirm("쮼st치s seguro de eliminar esta m치quina?");
        if (accion === 'reportar_mantenimiento') confirmacion = confirm("쯇oner en mantenimiento?");

        if (confirmacion) {
            document.getElementById('input_accion_opc').value = accion;
            document.getElementById('formOpciones').submit();
        }
    }
</script>

<style>
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }

    .modern-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
</style>

{% endblock %}